{% extends 'base_template.html.twig' %}

{#
 # @file reset_password.html.twig
 # @brief Template pour la page de réinitialisation de mot de passe.
 # 
 # Cette page affiche un formulaire permettant à l'utilisateur de définir
 # un nouveau mot de passe après avoir cliqué sur le lien de réinitialisation
 # reçu par email. Le token de réinitialisation est passé en variable.
 # 
 # @var string token Le token de réinitialisation de mot de passe.
 # @var string pseudo Le pseudo de l'utilisateur pour personnaliser l'accueil.
 # 
 # @extends base_template.html.twig
 #}

{% block content %}
	<div class="container py-5">
		<div class="row justify-content-center">
			<div class="col-md-6 col-lg-5">
				<div class="card shadow" id="resetPasswordCard">
					<div class="card-body p-4">
						<div class="text-center mb-4">
							<div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 64px; height: 64px;" id="iconContainer">
								<i class="bi bi-shield-lock fs-3"></i>
							</div>
						</div>

						<h1 class="h4 text-center mb-2" id="pageTitle">Nouveau mot de passe</h1>
						<p class="text-muted text-center mb-4" id="pageSubtitle">
							{% if pseudo %}
								Bonjour
								<strong>{{ pseudo }}</strong>
								! Choisissez un nouveau mot de passe sécurisé pour votre compte.
							{% else %}
								Choisissez un nouveau mot de passe sécurisé pour votre compte.
							{% endif %}
						</p>

						<div class="alert alert-danger d-none" role="alert" id="errorAlert"></div>
						<div class="alert alert-success d-none" role="alert" id="successAlert"></div>

						<form id="resetPasswordForm">
							<input type="hidden" name="token" value="{{ token }}">

							<div class="mb-3">
								<label for="password" class="form-label">Nouveau mot de passe</label>
								<div class="input-group">
									<input type="password" class="form-control" id="password" name="password" placeholder="••••••••" required minlength="8" maxlength="128" autocomplete="new-password" title="Le mot de passe doit contenir au moins 8 caractères, une majuscule, un chiffre et un symbole">
									<button class="btn btn-outline-secondary" type="button" aria-label="Afficher le mot de passe">
										<i class="bi bi-eye"></i>
									</button>
								</div>
								<div class="progress mt-2" style="height: 4px;">
									<div class="progress-bar" role="progressbar" id="strengthBar" style="width: 0%"></div>
								</div>
								<div class="small text-muted mt-2 p-2 bg-light rounded" id="passwordRequirements">
									<strong>Exigences du mot de passe :</strong>
									<ul class="mb-0 ps-3">
										<li id="req-length">Au moins 8 caractères</li>
										<li id="req-uppercase">Au moins une majuscule</li>
										<li id="req-number">Au moins un chiffre</li>
										<li id="req-special">Au moins un symbole (!@#$%^&*...)</li>
									</ul>
								</div>
							</div>

							<div class="mb-4">
								<label for="password_repeat" class="form-label">Confirmer le mot de passe</label>
								<div class="input-group">
									<input type="password" class="form-control" id="password_repeat" name="password_repeat" placeholder="••••••••" required minlength="8" maxlength="128" autocomplete="new-password" title="Répétez le même mot de passe">
									<button class="btn btn-outline-secondary" type="button" aria-label="Afficher le mot de passe">
										<i class="bi bi-eye"></i>
									</button>
								</div>
								<div class="form-text text-danger d-none" id="matchError">
									Les mots de passe ne correspondent pas.
								</div>
							</div>

							<button type="submit" class="btn btn-primary w-100" id="submitBtn">
								<span id="btnText">Réinitialiser mon mot de passe</span>
								<span id="btnSpinner" class="d-none">
									<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
									Réinitialisation en cours...
								</span>
							</button>
						</form>

						<div class="text-center mt-3 d-none" id="loginLink">
							<a href="/?controller=home&method=afficher" class="text-decoration-none" id="goToLogin">
								<i class="bi bi-box-arrow-in-right me-1"></i>
								Se connecter
							</a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
{% endblock %}

{% block script %}
<script src="/assets/js/reset-password.js"></script>
{% endblock %}
