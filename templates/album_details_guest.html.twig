{% extends "base_template.html.twig" %}

{% block header %}
	{{ parent() }}
	<link
	href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
	<!-- Importation des icônes Bootstrap (assumé) -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

	<style>
		body {
			font-family: 'Inter', sans-serif;
			background-color: #f0f0f0;
		}
		.content-bg {
			/* Couleurs de la palette Terre Cuite adaptées au gradient Twig */
			background: linear-gradient(135deg, #A5604E 0%, #E5A88E 100%);
		}

		/* --- Styles de la Playlist --- */
		.track-row {
			cursor: pointer;
			transition: background-color 0.2s;
			--bs-table-bg: transparent; /* Permet au gradient de background de s'appliquer */
			color: rgba(255, 255, 255, 0.9);
		}
		.track-row:nth-child(even) {
			background-color: rgba(0, 0, 0, 0.05);
		}
		.table-hover > tbody > tr:hover > * {
			--bs-table-hover-bg: rgba(0, 0, 0, 0.15);
		}

		/* --- Style de la piste active --- */
		.track-row.active-track {
			background-color: rgba(255, 255, 255, 0.2);
			font-weight: 600;
		}

		/* --- Styles de la Barre de Progression --- */
		.progress-bar-container {
			height: 6px;
			background-color: rgba(255, 255, 255, 0.3);
			cursor: pointer;
		}
		.progress-bar {
			height: 100%;
			background-color: white;
			transition: width 0.1s linear;
		}

		/* --- Styles du Contrôle de Volume --- */
		#volume-slider {
			-webkit-appearance: none;
			appearance: none;
			width: 80px;
			height: 5px;
			background: rgba(255, 255, 255, 0.3);
			border-radius: 5px;
			outline: none;
			transition: opacity 0.2s;
			cursor: pointer;
		}
		#volume-slider::-webkit-slider-thumb {
			-webkit-appearance: none;
			appearance: none;
			width: 14px;
			height: 14px;
			background: white;
			border-radius: 50%;
			cursor: pointer;
		}

		/* --- Styles pour la rotation de la pochette --- */
		@keyframes spin {
			from {
				transform: rotate(0deg);
			}
			to {
				transform: rotate(360deg);
			}
		}
		#album-cover.rotating {
			animation: spin 12s linear infinite;
			border-radius: 50%; /* Pour un effet "vinyle" */
		}
		#album-cover {
			transition: border-radius 0.5s ease-out; /* Transition douce vers la forme circulaire */
		}

		/* --- Styles de la navigation --- */
		.nav-link-custom {
			color: rgba(255, 255, 255, 0.7);
			transition: color 0.2s;
		}
		.nav-link-custom:hover,
		.nav-link-custom.active {
			color: white;
			font-weight: 600;
		}
		.navbar-custom {
			background-color: #3A1E18; /* Brun profond pour l'en-tête (équivalent de var(--color-earth-deep) */
		}
	</style>
{% endblock %}

{% block content %}
	{% set totalDuration = 0 %}
	{% for chanson in chansons %}
		{% set totalDuration = totalDuration + chanson.getDureeChanson() %}
	{% endfor %}
	{% set totalMinutes = (totalDuration / 60)|round(0, 'floor') %}
	{% set totalSeconds = totalDuration % 60 %}

	<!-- L'en-tête de navigation a été retiré, laissant la page commencer par le conteneur principal (main) -->

	<main class="container my-4 my-lg-5">
		<div class="content-bg rounded-3 shadow-lg p-3 p-lg-5 text-white">

			<div class="d-flex flex-column flex-md-row align-items-start gap-4">
				<div class="flex-shrink-0">
					<img id="album-cover" src="{{ album.getUrlPochetteAlbum() ?: 'https://placehold.co/160x160/7b4343/ffffff?text=' ~ (album.getTitreAlbum()|replace({' ': '+'})|slice(0, 20)) }}" alt="Couverture de l'album {{ album.getTitreAlbum() }}" class="rounded-2 shadow-lg" style="width: 160px; height: 160px; object-fit: cover;">
				</div>

				<div class="flex-grow-1">
					<span class="text-sm fw-light text-uppercase" style="letter-spacing: 0.1em; opacity: 0.8;">Album</span>
					<h2 class="display-4 fw-bolder mt-1 mb-2" id="album-title">{{ album.getTitreAlbum() }}</h2>
					<p class="fs-5 fw-light" id="album-meta" style="opacity: 0.9;">
						{{ album.getArtisteAlbum() }}
						{% if album.getDateSortieAlbum() %}
							·
							{{ album.getDateSortieAlbum()|date('Y') }}
						{% endif %}
						·
						{{ chansons|length }}
						titre{{ chansons|length > 1 ? 's' : '' }},
						{{ totalMinutes }}
						min
						{{ totalSeconds|number_format(0, '', '02') }}
						s
					</p>

					<!-- Lecteur Audio/Contrôles -->
					<div
						class="mt-4 pt-4 border-top border-light border-opacity-50">

						<!-- Titre de la piste en cours -->
						<p class="fs-6 fw-bold mb-2" id="current-track-title">Piste en cours : Aucune</p>

						<!-- Barre de Progression -->
						<div id="progress-bar-container" class="progress-bar-container rounded-pill" data-bs-toggle="modal" data-bs-target="#signinModal">
							<div id="progress-bar" class="progress-bar rounded-pill w-0"></div>
						</div>

						<!-- Temps Écoulé / Durée Totale -->
						<div class="d-flex justify-content-between text-xs mt-1" style="opacity: 0.8;">
							<span id="current-time">0:00</span>
							<span id="duration">0:00</span>
						</div>

						<!-- Boutons de Contrôle -->
						<div class="mt-3 d-flex gap-3 align-items-center">
							<button id="play-pause-btn" type="button" data-bs-toggle="modal" data-bs-target="#signinModal" class="btn btn-light text-dark rounded-circle shadow-sm" style="width: 48px; height: 48px;">
								<i id="play-pause-icon" class="bi bi-play-fill" style="font-size: 1.5rem; line-height: 1;"></i>
							</button>

							<!-- NOUVEAU: Bouton Aléatoire (Shuffle) -->
							<button type="button" class="btn btn-link p-0" title="Aléatoire" data-bs-toggle="modal" data-bs-target="#signinModal">
								<i class="bi bi-shuffle" style="font-size: 1.8rem; color: rgba(255, 255, 255, 0.9);"></i>
							</button>

							<!-- Bouton "Aimer l'album" agrandi -->
							<button type="button" class="btn btn-link p-0" title="Aimer l'album" data-bs-toggle="modal" data-bs-target="#signinModal">
								<i class="bi bi-heart-fill" style="font-size: 1.8rem; color: rgba(255, 255, 255, 0.9);"></i>
							</button>

							<!-- NOUVEAU: Contrôle du volume -->
							<div class="d-flex align-items-center ms-auto gap-2">
								<button id="volume-btn" type="button" class="btn btn-link p-0" data-bs-toggle="modal" data-bs-target="#signinModal">
									<i id="volume-icon" class="bi bi-volume-up-fill" style="font-size: 1.8rem; color: rgba(255, 255, 255, 0.9);"></i>
								</button>
								<input type="range" id="volume-slider" min="0" max="100" value="75" class="align-self-center" disabled>
							</div>

						</div>
					</div>
					<!-- Fin Lecteur Audio/Contrôles -->
				</div>
			</div>

			<div class="mt-5 overflow-x-auto">
				<table id="track-table" class="table table-hover align-middle">
					<thead style="background-color: rgba(0,0,0,0.2);">
						<tr class="text-sm text-uppercase fw-semibold" style="color: rgba(255,255,255,0.9); letter-spacing: 0.05em;">
							<th scope="col" class="py-3 px-4" style="width: 5%;">#</th>
							<th scope="col" class="py-3 px-4" style="width: 55%;">Titre</th>
							<th scope="col" class="py-3 px-4 d-none d-sm-table-cell" style="width: 20%;">Nombre d'écoutes</th>
							<th scope="col" class="py-3 px-4" style="width: 10%;">Durée</th>
							<th scope="col" class="py-3 px-4" style="width: 10%;"></th>
						</tr>
					</thead>
					<tbody>
						{% if chansons is not empty %}
							{% for chanson in chansons %}
								<tr class="track-row" data-index="{{ loop.index0 }}" style="color: rgba(255,255,255,0.9);" data-bs-toggle="modal" data-bs-target="#signinModal">
									<td class="py-3 px-4 fw-bold track-index">{{ loop.index }}</td>
									<td class="py-3 px-4 track-title">{{ chanson.getTitreChanson() }}</td>
									<td class="py-3 px-4 d-none d-sm-table-cell track-listens">0</td>
									<td class="py-3 px-4 track-duration">{{ (chanson.getDureeChanson() / 60)|round(0, 'floor') }}:{{ (chanson.getDureeChanson() % 60)|number_format(0, '', '02') }}</td>
									<td
										class="py-3 px-4 text-center">
										<!-- Bouton pour la lecture de la piste spécifique -->
										<button title="Lire la musique" class="btn btn-sm btn-link p-1 play-track-btn" data-index="{{ loop.index0 }}" data-bs-toggle="modal" data-bs-target="#signinModal">
											<i class="bi bi-play-fill track-play-icon" style="color: rgba(255,255,255,0.7); font-size: 1.2rem;"></i>
										</button>
										<button title="Aimer la musique" class="btn btn-sm btn-link p-1" data-bs-toggle="modal" data-bs-target="#signinModal">
											<i class="bi bi-heart" style="color: rgba(255,255,255,0.7); font-size: 1rem;"></i>
										</button>
									</td>
								</tr>
							{% endfor %}
						{% else %}
							<tr>
								<td colspan="5" class="text-center py-4" style="opacity: 0.8;">Cet album ne contient aucune chanson pour le moment.</td>
							</tr>
						{% endif %}
					</tbody>
				</table>
			</div>
		</div>
	</main>
{% endblock %}